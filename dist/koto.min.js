var _prototypeProperties=function(t,e,r){e&&Object.defineProperties(t,e),r&&Object.defineProperties(t.prototype,r)},_classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):t.koto=e(t.d3)}(this,function(t){"use strict";function e(t,e){if(!t)throw new Error("[koto] "+e)}var r=function(){function t(e){_classCallCheck(this,t),this.base=e,this.hasDrawn=!1,this._layers={},this._attached={},this._events={},this._configs={},this._accessors={}}return _prototypeProperties(t,null,{transform:{value:function(t){return t},writable:!0,configurable:!0},demux:{value:function(t,e){return e},writable:!0,configurable:!0},preDraw:{value:function(){},writable:!0,configurable:!0},postDraw:{value:function(){},writable:!0,configurable:!0},unlayer:{value:function(t){var e=this.layer(t);return delete this._layers[t],delete e._chart,e},writable:!0,configurable:!0},layer:{value:function(t,r,n){var i;if(1===arguments.length)return this._layers[t];if(2===arguments.length){if("function"==typeof r.draw)return r._chart=this,this._layers[t]=r,this._layers[t];e(!1,"When reattaching a layer, the second argument must be a d3.chart layer")}return i=r.layer(n),this._layers[t]=i,r._chart=this,i},writable:!0,configurable:!0},attach:{value:function(t,e){return 1===arguments.length?this._attached[t]:(this._attached[t]=e,e)},writable:!0,configurable:!0},draw:{value:function(t){var e,r,n,i=this.transform(t);this.preDraw(i);for(e in this._layers)this._layers[e].draw(i);for(r in this._attached)n=this.demux?this.demux(r,i):i,this._attached[r].draw(n);this.hasDrawn=!0,this.postDraw(i)},writable:!0,configurable:!0},on:{value:function(t,e,r){var n=this._events[t]||(this._events[t]=[]);return n.push({callback:e,context:r||this,_chart:this}),this},writable:!0,configurable:!0},once:{value:function(t,e,r){var n=this,i=function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(){n.off(t,i),e.apply(this,arguments)});return this.on(t,i,r)},writable:!0,configurable:!0},off:{value:function(t,e,r){var n,i,a,s,o,c;if(0===arguments.length){for(t in this._events)this._events[t].length=0;return this}if(1===arguments.length)return a=this._events[t],a&&(a.length=0),this;for(n=t?[t]:Object.keys(this._events),o=0;o<n.length;o++)for(i=n[o],a=this._events[i],c=a.length;c--;)s=a[c],(e&&e===s.callback||r&&r===s.context)&&a.splice(c,1);return this},writable:!0,configurable:!0},trigger:{value:function(t){var e,r,n=Array.prototype.slice.call(arguments,1),i=this._events[t];if(void 0!==i)for(e=0;e<i.length;e++)r=i[e],r.callback.apply(r.context,n);return this},writable:!0,configurable:!0},config:{value:function(t,r){var n;if(0===arguments.length)return this._configs;if(1===arguments.length){if("object"==typeof t){for(n in t)this._configs[n]=t[n];return this}return e(this._configs[t],""+t+" is not a valid option."),this._configs[t]}return 2===arguments.length?(this._configs[t]=r,this):void 0},writable:!0,configurable:!0},accessor:{value:function(t,r){var n;if(0===arguments.length)return this._accessors;if(1===arguments.length){if("string"==typeof t)return e(this._accessors[t],""+t+" is not a valid accessor."),"object"==typeof this._accessors[t]?this._accessors[t].accessor:this._accessors[t];for(n in t)this._accessors[n]=t[n]}else this._accessors[t]=r;return this},writable:!0,configurable:!0}}),t}(),n=/^(enter|update|merge|exit)(:transition)?$/,i=function(){function r(t){_classCallCheck(this,r),this._base=t,this._handlers={}}return _prototypeProperties(r,null,{dataBind:{value:function(){e(!1,"Layers must specify a dataBind method.")},writable:!0,configurable:!0},insert:{value:function(){e(!1,"Layers must specify an `insert` method.")},writable:!0,configurable:!0},on:{value:function(t,r,i){return i=i||{},e(n.test(t),"Unrecognized lifecycle event name specified to 'Layer#on': '"+t+"'."),t in this._handlers||(this._handlers[t]=[]),this._handlers[t].push({callback:r,chart:i.chart||null}),this._base},writable:!0,configurable:!0},off:{value:function(t,r){var i,a=this._handlers[t];if(e(n.test(t),"Unrecognized lifecycle event name specified to 'Layer#on': '"+t+"'."),!a)return this._base;if(1===arguments.length)return a.length=0,this._base;for(i=a.length-1;i>-1;--i)a[i].callback===r&&a.splice(i,1);return this._base},writable:!0,configurable:!0},draw:{value:function(r){var n,i,a,s,o,c,l,h,u,f,g;n=this.dataBind.call(this._base,r),e(n instanceof t.selection,"Invalid selection defined by `Layer#dataBind` method."),e(n.enter,"Layer selection not properly bound."),i=n.enter(),i._chart=this._base._chart,a=[{name:"update",selection:n},{name:"enter",selection:i,method:this.insert},{name:"merge",selection:n},{name:"exit",selection:n,method:n.exit}];for(var d=0,_=a.length;_>d;++d)if(l=a[d].name,s=a[d].selection,o=a[d].method,"function"==typeof o&&(s=o.call(s)),!s.empty()){if(e(s&&s instanceof t.selection,"Invalid selection defined for "+l+" lifecycle event."),c=this._handlers[l])for(h=0,u=c.length;u>h;++h)s._chart=c[h].chart||this._base._chart,s.call(c[h].callback);if(c=this._handlers[l+":transition"],c&&c.length)for(s=s.transition(),g=c.length,f=0;g>f;++f)s._chart=c[f].chart||this._base._chart,s.call(c[f].callback)}},writable:!0,configurable:!0}}),r}();e(t,"d3.js is required");var a=function(){function t(e,r){_classCallCheck(this,t),this._registry={},this.Layer=e,this.Chart=r}return _prototypeProperties(t,null,{chart:{value:function(t,r){var n,i=this;return 0===arguments.length?this._registry:1===arguments.length?(e(this._registry[t],"no chart registered with name "+t),n=this._registry[t],n.extend=function(t,e){return i._registry[t]=e(n),i._registry[t]},n):(this._registry[t]=r(this.Chart),this._registry[t])},writable:!0,configurable:!0}}),t}(),s=new a(i,r);t.selection.prototype.chart=function(t){if(0===arguments.length)return this._chart;var e=s.chart(t);return new e(this)},t.selection.enter.prototype.chart=function(){return this._chart},t.transition.prototype.chart=t.selection.enter.prototype.chart,t.selection.prototype.layer=function(t){var e,r=new i(this);if(r.dataBind=t.dataBind,r.insert=t.insert,"events"in t)for(e in t.events)r.on(e,t.events[e]);return this.on=function(){return r.on.apply(r,arguments)},this.off=function(){return r.off.apply(r,arguments)},this.draw=function(){return r.draw.apply(r,arguments)},this},e(t,"d3.js is required");var o=s;return o});
//# sourceMappingURL=koto.min.js.map