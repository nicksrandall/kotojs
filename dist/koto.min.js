var _prototypeProperties=function(t,e,n){e&&Object.defineProperties(t,e),n&&Object.defineProperties(t.prototype,n)},_classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.koto=e()}(this,function(){"use strict";function t(t,e){if(!t)throw new Error("[koto] "+e)}var e=function(){function e(t){_classCallCheck(this,e),this.base=t,this.hasDrawn=!1,this._layers={},this._attached={},this._events={},this._configs={},this._accessors={}}return _prototypeProperties(e,null,{transform:{value:function(t){return t},writable:!0,configurable:!0},demux:{value:function(t,e){return e},writable:!0,configurable:!0},preDraw:{value:function(){},writable:!0,configurable:!0},postDraw:{value:function(){},writable:!0,configurable:!0},unlayer:{value:function(t){var e=this.layer(t);return delete this._layers[t],delete e._chart,e},writable:!0,configurable:!0},layer:{value:function(e,n,r){var i;if(1===arguments.length)return this._layers[e];if(2===arguments.length){if("function"==typeof n.draw)return n._chart=this,this._layers[e]=n,this._layers[e];t(!1,"When reattaching a layer, the second argument must be a d3.chart layer")}return i=n.layer(r),this._layers[e]=i,n._chart=this,i},writable:!0,configurable:!0},attach:{value:function(t,e){return 1===arguments.length?this._attached[t]:(this._attached[t]=e,e)},writable:!0,configurable:!0},draw:{value:function(t){var e,n,r,i=this.transform(t);this.preDraw(i);for(e in this._layers)this._layers[e].draw(i);for(n in this._attached)r=this.demux?this.demux(n,i):i,this._attached[n].draw(r);this.hasDrawn=!0,this.postDraw(i)},writable:!0,configurable:!0},on:{value:function(t,e,n){var r=this._events[t]||(this._events[t]=[]);return r.push({callback:e,context:n||this,_chart:this}),this},writable:!0,configurable:!0},once:{value:function(t,e,n){var r=this,i=function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(){r.off(t,i),e.apply(this,arguments)});return this.on(t,i,n)},writable:!0,configurable:!0},off:{value:function(t,e,n){var r,i,a,s,o,c;if(0===arguments.length){for(t in this._events)this._events[t].length=0;return this}if(1===arguments.length)return a=this._events[t],a&&(a.length=0),this;for(r=t?[t]:Object.keys(this._events),o=0;o<r.length;o++)for(i=r[o],a=this._events[i],c=a.length;c--;)s=a[c],(e&&e===s.callback||n&&n===s.context)&&a.splice(c,1);return this},writable:!0,configurable:!0},trigger:{value:function(t){var e,n,r=Array.prototype.slice.call(arguments,1),i=this._events[t];if(void 0!==i)for(e=0;e<i.length;e++)n=i[e],n.callback.apply(n.context,r);return this},writable:!0,configurable:!0},config:{value:function(e,n){var r;if(0===arguments.length)return this._configs;if(1===arguments.length){if("object"==typeof e){for(r in e)this._configs[r]=e[r];return this}return t(this._configs[e],""+e+" is not a valid option."),this._configs[e]}return 2===arguments.length?(this._configs[e]=n,this):void 0},writable:!0,configurable:!0},accessor:{value:function(e,n){var r;if(0===arguments.length)return this._accessors;if(1===arguments.length){if("string"==typeof e)return t(this._accessors[e],""+e+" is not a valid accessor."),"object"==typeof this._accessors[e]?this._accessors[e].accessor:this._accessors[e];for(r in e)this._accessors[r]=e[r]}else this._accessors[e]=n;return this},writable:!0,configurable:!0}}),e}(),n=/^(enter|update|merge|exit)(:transition)?$/,r=function(){function e(t){_classCallCheck(this,e),this._base=t,this._handlers={}}return _prototypeProperties(e,null,{dataBind:{value:function(){t(!1,"Layers must specify a dataBind method.")},writable:!0,configurable:!0},insert:{value:function(){t(!1,"Layers must specify an `insert` method.")},writable:!0,configurable:!0},on:{value:function(e,r,i){return i=i||{},t(n.test(e),"Unrecognized lifecycle event name specified to 'Layer#on': '"+e+"'."),e in this._handlers||(this._handlers[e]=[]),this._handlers[e].push({callback:r,chart:i.chart||null}),this._base},writable:!0,configurable:!0},off:{value:function(e,r){var i,a=this._handlers[e];if(t(n.test(e),"Unrecognized lifecycle event name specified to 'Layer#on': '"+e+"'."),!a)return this._base;if(1===arguments.length)return a.length=0,this._base;for(i=a.length-1;i>-1;--i)a[i].callback===r&&a.splice(i,1);return this._base},writable:!0,configurable:!0},draw:{value:function(e){var n,r,i,a,s,o,c,l,h,u,f;n=this.dataBind.call(this._base,e),t(n instanceof d3.selection,"Invalid selection defined by `Layer#dataBind` method."),t(n.enter,"Layer selection not properly bound."),r=n.enter(),r._chart=this._base._chart,i=[{name:"update",selection:n},{name:"enter",selection:r,method:this.insert},{name:"merge",selection:n},{name:"exit",selection:n,method:n.exit}];for(var g=0,d=i.length;d>g;++g)if(c=i[g].name,a=i[g].selection,s=i[g].method,"function"==typeof s&&(a=s.call(a)),!a.empty()){if(t(a&&a instanceof d3.selection,"Invalid selection defined for "+c+" lifecycle event."),o=this._handlers[c])for(l=0,h=o.length;h>l;++l)a._chart=o[l].chart||this._base._chart,a.call(o[l].callback);if(o=this._handlers[c+":transition"],o&&o.length)for(a=a.transition(),f=o.length,u=0;f>u;++u)a._chart=o[u].chart||this._base._chart,a.call(o[u].callback)}},writable:!0,configurable:!0}}),e}();t(d3,"d3.js is required");var i=function(){function e(t,n){_classCallCheck(this,e),this._registry={},this.Layer=t,this.Chart=n}return _prototypeProperties(e,null,{chart:{value:function(e,n){var r,i=this;return 0===arguments.length?this._registry:1===arguments.length?(t(this._registry[e],"no chart registered with name "+e),r=this._registry[e],r.extend=function(t,e){return i._registry[t]=e(r),i._registry[t]},r):(this._registry[e]=n(this.Chart),this._registry[e])},writable:!0,configurable:!0}}),e}(),a=new i(r,e);return d3.selection.prototype.chart=function(t){if(0===arguments.length)return this._chart;var e=a.chart(t);return new e(this)},d3.selection.enter.prototype.chart=function(){return this._chart},d3.transition.prototype.chart=d3.selection.enter.prototype.chart,d3.selection.prototype.layer=function(t){var e,n=new r(this);if(n.dataBind=t.dataBind,n.insert=t.insert,"events"in t)for(e in t.events)n.on(e,t.events[e]);return this.on=function(){return n.on.apply(n,arguments)},this.off=function(){return n.off.apply(n,arguments)},this.draw=function(){return n.draw.apply(n,arguments)},this},a});
//# sourceMappingURL=koto.min.js.map