var _prototypeProperties=function(a,b,c){b&&Object.defineProperties(a,b),c&&Object.defineProperties(a.prototype,c)},_classCallCheck=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")};!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.koto=b()}(this,function(){"use strict";function a(a,b){if(!a)throw new Error("[koto] "+b)}var b=function(){function b(a,c){_classCallCheck(this,b),this.base=a,this.hasDrawn=!1,this._layers={},this._attached={},this._events={},c&&c.transform&&(this.transform=c.transform)}return _prototypeProperties(b,null,{transform:{value:function(a){return a},writable:!0,configurable:!0},preDraw:{value:function(){},writable:!0,configurable:!0},postDraw:{value:function(){},writable:!0,configurable:!0},unlayer:{value:function(a){var b=this.layer(a);return delete this._layers[a],delete b._chart,b},writable:!0,configurable:!0},layer:{value:function c(b,d,e){var c;if(1===arguments.length)return this._layers[b];if(2===arguments.length){if("function"==typeof d.draw)return d._chart=this,this._layers[b]=d,this._layers[b];a(!1,"When reattaching a layer, the second argument must be a d3.chart layer")}return c=d.layer(e),this._layers[b]=c,d._chart=this,c},writable:!0,configurable:!0},attach:{value:function(a,b){return 1===arguments.length?this._attached[a]:(this._attached[a]=b,b)},writable:!0,configurable:!0},draw:{value:function(a){var b,c,d,e=this.transform(a);this.preDraw(e);for(b in this._layers)this._layers[b].draw(e);for(c in this._attached)d=this.demux?this.demux(c,e):e,this._attached[c].draw(d);this.hasDrawn=!0,this.postDraw(e)},writable:!0,configurable:!0},on:{value:function(a,b,c){var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c||this,_chart:this}),this},writable:!0,configurable:!0},once:{value:function d(a,b,c){var e=this,d=function(){e.off(a,d),b.apply(this,arguments)};return this.on(a,d,c)},writable:!0,configurable:!0},off:{value:function(a,b,c){var d,e,f,g,h,i;if(0===arguments.length){for(a in this._events)this._events[a].length=0;return this}if(1===arguments.length)return f=this._events[a],f&&(f.length=0),this;for(d=a?[a]:Object.keys(this._events),h=0;h<d.length;h++)for(e=d[h],f=this._events[e],i=f.length;i--;)g=f[i],(b&&b===g.callback||c&&c===g.context)&&f.splice(i,1);return this},writable:!0,configurable:!0},trigger:{value:function(a){var b,c,d=Array.prototype.slice.call(arguments,1),e=this._events[a];if(void 0!==e)for(b=0;b<e.length;b++)c=e[b],c.callback.apply(c.context,d);return this},writable:!0,configurable:!0}}),b}(),c=/^(enter|update|merge|exit)(:transition)?$/,d=function(){function b(a){_classCallCheck(this,b),this._base=a,this._handlers={}}return _prototypeProperties(b,null,{dataBind:{value:function(){a(!1,"Layers must specify a dataBind method.")},writable:!0,configurable:!0},insert:{value:function(){a(!1,"Layers must specify an `insert` method.")},writable:!0,configurable:!0},on:{value:function(b,d,e){return e=e||{},a(c.test(b),"Unrecognized lifecycle event name specified to `Layer#on`: '${eventName}'."),b in this._handlers||(this._handlers[b]=[]),this._handlers[b].push({callback:d,chart:e.chart||null}),this._base},writable:!0,configurable:!0},off:{value:function(b,d){var e,f=this._handlers[b];if(a(c.test(b),"Unrecognized lifecycle event name specified to `Layer#on`: '${eventName}'."),!f)return this._base;if(1===arguments.length)return f.length=0,this._base;for(e=f.length-1;e>-1;--e)f[e].callback===d&&f.splice(e,1);return this._base},writable:!0,configurable:!0},draw:{value:function(a){var b,c,d,e,f,g,h,i,j;b=this.dataBind.call(this._base,a),c=b.enter(),c._chart=this._base._chart,d=[{name:"update",selection:b},{name:"enter",selection:c,method:this.insert},{name:"merge",selection:b},{name:"exit",selection:b,method:b.exit}];for(var k=0,l=d.length;l>k;++k)if(h=d[k].name,e=d[k].selection,f=d[k].method,"function"==typeof f&&(e=f.call(e)),!e.empty()){if(g=this._handlers[h])for(i=0,j=g.length;j>i;++i)e._chart=g[i].chart||this._base._chart,e.call(g[i].callback);if(g=this._handlers[h+":transition"],g&&g.length)for(e=e.transition(),i=0,j=g.length;j>i;++i)e._chart=g[i].chart||this._base._chart,e.call(g[i].callback)}},writable:!0,configurable:!0}}),b}(),e=function(){function b(){for(var a=arguments.length,c=Array(a),d=0;a>d;d++)c[d]=arguments[d];_classCallCheck(this,b);var e,f;for(this._options=c[0],e=1;e<c.length;e++)for(f in c[e])this._options[f]=c[e][f]}return _prototypeProperties(b,null,{get:{value:function(b){return a(this._options[b].value,"no option with that name"),this._options[b].value},writable:!0,configurable:!0},set:{value:function(a){var b;for(b in a)this._options[b]=a[b];return this},writable:!0,configurable:!0},remove:{value:function(a){return delete this._options[a],this},writable:!0,configurable:!0}}),b}();a(d3,"d3.js is required");var f=function(){function a(b,c,d){_classCallCheck(this,a),this._registry={},this.Options=b,this.Layer=c,this.Chart=d}return _prototypeProperties(a,null,{chart:{value:function(a,b){var c;return 0===arguments.length?this._registry:1===arguments.length?(c=this._registry[a],c["extends"]=function(b,c){this._registry[b]=c(this._registry[a])},c):(this._registry[a]=b(this.Chart),this._registry[a])},writable:!0,configurable:!0}}),a}(),g=new f(e,d,b);return d3.selection.prototype.chart=function(a,b){if(0===arguments.length)return this._chart;var c=g.chart(a);return new c(this,b)},d3.selection.enter.prototype.chart=function(){return this._chart},d3.transition.prototype.chart=d3.selection.enter.prototype.chart,d3.selection.prototype.layer=function(a){var b,c=new d(this);if(c.dataBind=a.dataBind,c.insert=a.insert,"events"in a)for(b in a.events)c.on(b,a.events[b]);return this.on=function(){return c.on.apply(c,arguments)},this.off=function(){return c.off.apply(c,arguments)},this.draw=function(){return c.draw.apply(c,arguments)},this},g});
//# sourceMappingURL=koto.min.js.map