function kotoAssert(t,e){if(!t)throw new Error("[koto] "+e)}function selectionHandler(t,e){var r,n;for(r=0,n=e.length;n>r;++r)t._chart=e[r].chart||this._base._chart,t.call(e[r].callback)}module.exports=kotoAssert;var _interopRequire=function(t){return t&&t.__esModule?t["default"]:t},_prototypeProperties=function(t,e,r){e&&Object.defineProperties(t,e),r&&Object.defineProperties(t.prototype,r)},_classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},kotoAssert=_interopRequire(require("./assert.js")),Chart=function(){function t(e){_classCallCheck(this,t),this.base=e,this.hasDrawn=!1,this._layers={},this._attached={},this._events={},this._configs={},this._accessors={}}return _prototypeProperties(t,null,{transform:{value:function(t){return t},writable:!0,configurable:!0},demux:{value:function(t,e){return e},writable:!0,configurable:!0},preDraw:{value:function(){},writable:!0,configurable:!0},postDraw:{value:function(){},writable:!0,configurable:!0},unlayer:{value:function(t){var e=this.layer(t);return delete this._layers[t],delete e._chart,e},writable:!0,configurable:!0},layer:{value:function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(t,e,r){var n;if(1===arguments.length)return this._layers[t];if(2===arguments.length){if("function"==typeof e.draw)return e._chart=this,this._layers[t]=e,this._layers[t];kotoAssert(!1,"When reattaching a layer, the second argument must be a d3.chart layer")}return n=e.layer(r),this._layers[t]=n,e._chart=this,n}),writable:!0,configurable:!0},attach:{value:function(t,e){return 1===arguments.length?this._attached[t]:(this._attached[t]=e,e)},writable:!0,configurable:!0},draw:{value:function(t){var e,r,n,i=this.transform(t);this.preDraw(i);for(e in this._layers)this._layers[e].draw(i);for(r in this._attached)n=this.demux?this.demux(r,i):i,this._attached[r].draw(n);this.hasDrawn=!0,this.postDraw(i)},writable:!0,configurable:!0},on:{value:function(t,e,r){var n=this._events[t]||(this._events[t]=[]);return n.push({callback:e,context:r||this,_chart:this}),this},writable:!0,configurable:!0},once:{value:function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(t,e,r){var n=this,i=function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(){n.off(t,i),e.apply(this,arguments)});return this.on(t,i,r)}),writable:!0,configurable:!0},off:{value:function(t,e,r){var n,i,s,a,o,c;if(0===arguments.length){for(t in this._events)this._events[t].length=0;return this}if(1===arguments.length)return s=this._events[t],s&&(s.length=0),this;for(n=t?[t]:Object.keys(this._events),o=0;o<n.length;o++)for(i=n[o],s=this._events[i],c=s.length;c--;)a=s[c],(e&&e===a.callback||r&&r===a.context)&&s.splice(c,1);return this},writable:!0,configurable:!0},trigger:{value:function(t){var e,r,n=Array.prototype.slice.call(arguments,1),i=this._events[t];if(void 0!==i)for(e=0;e<i.length;e++)r=i[e],r.callback.apply(r.context,n);return this},writable:!0,configurable:!0},config:{value:function(t,e){var r;if(0===arguments.length)return this._configs;if(1===arguments.length){if("object"==typeof t){for(r in t)this._configs[r]=t[r];return this}return kotoAssert(this._configs[t],""+t+" is not a valid option."),this._configs[t]}return 2===arguments.length?(this._configs[t]=e,this):void 0},writable:!0,configurable:!0},accessor:{value:function(t,e){var r;if(0===arguments.length)return this._accessors;if(1===arguments.length){if("string"==typeof t)return kotoAssert(this._accessors[t],""+t+" is not a valid accessor."),"object"==typeof this._accessors[t]?this._accessors[t].accessor:this._accessors[t];for(r in t)this._accessors[r]?this._accessors[r]=t[r]:console.warn(""+r+" is not a valid accessor.")}else this._accessors[t]=e;return this},writable:!0,configurable:!0}}),t}();module.exports=Chart;var _interopRequire=function(t){return t&&t.__esModule?t["default"]:t},_prototypeProperties=function(t,e,r){e&&Object.defineProperties(t,e),r&&Object.defineProperties(t.prototype,r)},_classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},kotoAssert=_interopRequire(require("./assert.js")),Chart=_interopRequire(require("./chart.js")),Layer=_interopRequire(require("./layer.js"));kotoAssert(d3,"d3.js is required");var Koto=function(){function t(e,r){_classCallCheck(this,t),this._registry={},this.Layer=e,this.Chart=r}return _prototypeProperties(t,null,{chart:{value:function(t,e){var r;return 0===arguments.length?this._registry:1===arguments.length?(r=this._registry[t],kotoAssert(r,"no chart registered with name "+t),r):(this._registry[t]=e(this.Chart),this._registry[t])},writable:!0,configurable:!0}}),t}(),koto=new Koto(Layer,Chart);d3.selection.prototype.chart=function(t){if(0===arguments.length)return this._chart;var e=koto.chart(t);return new e(this)},d3.selection.enter.prototype.chart=function(){return this._chart},d3.transition.prototype.chart=d3.selection.enter.prototype.chart,d3.selection.prototype.layer=function(t){var e,r=new Layer(this);if(r.dataBind=t.dataBind,r.insert=t.insert,"events"in t)for(e in t.events)r.on(e,t.events[e]);return this.on=function(){return r.on.apply(r,arguments)},this.off=function(){return r.off.apply(r,arguments)},this.draw=function(){return r.draw.apply(r,arguments)},this},module.exports=koto;var _interopRequire=function(t){return t&&t.__esModule?t["default"]:t},_prototypeProperties=function(t,e,r){e&&Object.defineProperties(t,e),r&&Object.defineProperties(t.prototype,r)},_classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},kotoAssert=_interopRequire(require("./assert.js")),lifecycleRe=/^(enter|update|merge|exit)(:transition)?$/,Layer=function(){function t(e){_classCallCheck(this,t),this._base=e,this._handlers={}}return _prototypeProperties(t,null,{dataBind:{value:function(){kotoAssert(!1,"Layers must specify a dataBind method.")},writable:!0,configurable:!0},insert:{value:function(){kotoAssert(!1,"Layers must specify an `insert` method.")},writable:!0,configurable:!0},on:{value:function(t,e,r){return r=r||{},kotoAssert(lifecycleRe.test(t),"Unrecognized lifecycle event name specified to 'Layer#on': '"+t+"'."),t in this._handlers||(this._handlers[t]=[]),this._handlers[t].push({callback:e,chart:r.chart||null}),this},writable:!0,configurable:!0},off:{value:function(t,e){var r,n=this._handlers[t];if(kotoAssert(lifecycleRe.test(t),"Unrecognized lifecycle event name specified to 'Layer#on': '"+t+"'."),!n)return this._base;if(1===arguments.length)return n.length=0,this._base;for(r=n.length-1;r>-1;--r)n[r].callback===e&&n.splice(r,1);return this},writable:!0,configurable:!0},draw:{value:function(t){var e,r,n,i,s,a,o,c;e=this.dataBind.call(this._base,t),kotoAssert(e instanceof d3.selection,"Invalid selection defined by `Layer#dataBind` method."),kotoAssert(e.enter,"Layer selection not properly bound."),r=e.enter(),r._chart=this._base._chart,n=[{name:"update",selection:e},{name:"enter",selection:r,method:this.insert},{name:"merge",selection:e},{name:"exit",selection:e,method:e.exit}];for(var l=0,u=n.length;u>l;++l)c=n[l].name,i=n[l].selection,s=n[l].method,"function"==typeof s&&(i=s.call(i)),i.empty()||(kotoAssert(i&&i instanceof d3.selection,"Invalid selection defined for "+c+" lifecycle event."),a=this._handlers[c],a&&selectionHandler.call(this,i,a),o=this._handlers[c+":transition"],a&&a.length&&(i=i.transition(),selectionHandler.call(this,i,o)))},writable:!0,configurable:!0}}),t}();module.exports=Layer;
//# sourceMappingURL=koto.min.js.map