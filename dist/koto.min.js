function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):t.Koto=e(t.d3)}(this,function(t){"use strict";function e(t,e){if(!t)throw new Error("[koto] "+e)}var n=e,i=function(){function e(t,n){if(_classCallCheck(this,e),this._base=t,this._handlers={},this._lifecycleRe=/^(enter|update|merge|exit)(:transition)?$/,n&&(this.dataBind=n.dataBind,this.insert=n.insert,"events"in n))for(var i in n.events)this.on(i,n.events[i])}return e.prototype.dataBind=function(){n(!1,"Layers must specify a dataBind method.")},e.prototype.insert=function(){n(!1,"Layers must specify an `insert` method.")},e.prototype.on=function(t,e,i){return i=i||{},n(this._lifecycleRe.test(t),"Unrecognized lifecycle event name specified to 'Layer#on': '"+t+"'."),t in this._handlers||(this._handlers[t]=[]),this._handlers[t].push({callback:e,chart:i.chart||null}),this},e.prototype.off=function(t,e){var i,r=this._handlers[t];if(n(this._lifecycleRe.test(t),"Unrecognized lifecycle event name specified to 'Layer#on': '"+t+"'."),!r)return this;if(1===arguments.length)return r.length=0,this;for(i=r.length-1;i>-1;--i)r[i].callback===e&&r.splice(i,1);return this},e.prototype.draw=function(e){function i(t,e){var n=0;0===t.size()?e():t.each(function(){++n}).each("interrupt.promise",function(){e.apply(this,arguments)}).each("end.promise",function(){--n||e.apply(this,arguments)})}function r(t){c.call(i,function(){t(!0)})}var s,a,o,c,h,l,f,u,p,g,d,y=[];s=this.dataBind.call(this._base,e),n(s instanceof t.selection,"Invalid selection defined by `Layer#dataBind` method."),n(s.enter,"Layer selection not properly bound."),a=s.enter(),a._chart=this._base._chart,o=[{name:"update",selection:s},{name:"enter",selection:a,method:this.insert},{name:"merge",selection:s},{name:"exit",selection:s,method:s.exit}];for(var m=0,v=o.length;v>m;++m)if(f=o[m].name,c=o[m].selection,h=o[m].method,"function"==typeof h&&(c=h.call(c)),!c.empty()){if(n(c&&c instanceof t.selection,"Invalid selection defined for "+f+" lifecycle event."),l=this._handlers[f])for(u=0,p=l.length;p>u;++u)c._chart=l[u].chart||this._base._chart,c.call(l[u].callback);if(l=this._handlers[f+":transition"],l&&l.length)for(c=c.transition(),d=l.length,g=0;d>g;++g)c._chart=l[g].chart||this._base._chart,c.call(l[g].callback),y.push(new Promise(r));this.promise=Promise.all(y)}},e}(),r=i;n(t,"d3 js is required.");var s=function(){function t(e){function n(t,e){for(var n=function(e,n){t.set(n,e)},i=0,r=e.length;r>i;++i){var s=e[i];s.forEach(n)}return t}_classCallCheck(this,t),this.base=e,this.hasDrawn=!1,this.merge={configs:function(){var t=n(this.configs,arguments);return t}.bind(this),accessors:function(){var t=n(this.accessors,arguments);return t}.bind(this)},this.configs=new Map,this.accessors=new Map,this.promise=null,this._layers=new Map,this._attached=new Map,this._events=new Map,this.c=this.config,this.a=this.accessor}return t.prototype.transform=function(t){return t},t.prototype.demux=function(t,e){return e},t.prototype.preDraw=function(){},t.prototype.postDraw=function(){},t.prototype.postTransition=function(){},t.prototype.unlayer=function(t){var e=this.layer(t);return this._layers["delete"](t),delete e._chart,e},t.prototype.layer=function(t,e,i){var s,a=this;if(1===arguments.length)return this._layers.get(t);if(2===arguments.length){if(e instanceof r)return e._chart=this,this._layers.set(t,e),this._layers.get(t);n(!1,"When reattaching a layer, the second argument must be a koto layer")}return e._chart=this,s=new r(e,i),s.remove=function(){return a._layers["delete"](t),this},this._layers.set(t,s),s},t.prototype.attach=function(t,e){return 1===arguments.length?this._attached.get(t):(this._attached.set(t,e),e)},t.prototype.draw=function(t){var e,n,i=[],r=this.transform(t);this.preDraw(r),this.trigger("preDraw",r);for(var s=this._layers.values(),a=Array.isArray(s),o=0,s=a?s:s[Symbol.iterator]();;){if(a){if(o>=s.length)break;e=s[o++]}else{if(o=s.next(),o.done)break;e=o.value}e.draw(r),i.push(e.promise)}for(var c=this._attached.entries(),h=Array.isArray(c),l=0,c=h?c:c[Symbol.iterator]();;){var f;if(h){if(l>=c.length)break;f=c[l++]}else{if(l=c.next(),l.done)break;f=l.value}var u=f[0],p=f[1];n=this.demux?this.demux(u,r):r,p.draw(n),i.push(p.promise)}this.hasDrawn=!0,this.promise=Promise.all(i),this.postDraw(),this.trigger("postDraw",r),this.promise.then(function(){this.postTransition(r),this.trigger("postTransition",r)}.bind(this))},t.prototype.on=function(t,e,n){var i;return i=this._events.has(t)?this._events.get(t):new Set,i.add({callback:e,context:n||this,_chart:this}),this._events.set(t,i),this},t.prototype.once=function(t,e,n){var i=this,r=function s(){i.off(t,s),e.apply(this,arguments)};return this.on(t,r,n)},t.prototype.off=function(t,e,n){return 0===arguments.length?(this._events.clear(),this):1===arguments.length?(this._events.has(t)&&this._events.get(t).clear(),this):(this._events.get(t).forEach(function(t,i,r){(e&&e===i.callback||n&&n===i.context)&&r["delete"](t)}),this)},t.prototype.trigger=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;e>i;i++)n[i-1]=arguments[i];return this._events.has(t)&&this._events.get(t).forEach(function(t){var e;(e=t.callback).call.apply(e,[t.context].concat(n))}),this},t.prototype.config=function(t,e){function i(){function t(t,e){var n=Math.min.call(null,t.map(function(t){return a.config(t)}));return e/n}s.constrain===!0?s.percentage=t(["width","height"],s.value):Array.isArray(s.constrain)?s.percentage=t(s.constrain,s.value):s.percentage=t([s.constrain],s.value)}var r,s,a=this;if(0===arguments.length)return this.configs;if(1===arguments.length){if("object"==typeof t){for(r in t)this.configs.has(r)?(s=this.configs.get(r),s.hasOwnProperty("setter")?s.value=s.setter.call(s,t[r]):s.value=t[r],s.hasOwnProperty("constrain")&&i(),this.configs.set(r,s)):console.warn("config with name "+t+" is not defined.");return this}return n(this.configs.has(t),""+t+" is not a valid option."),s=this.configs.get(t),s.hasOwnProperty("getter")?s.getter.call(s):s.value}return 2===arguments.length?(this.configs.has(t)?(s=this.configs.get(t),s.hasOwnProperty("setter")?s.value=s.setter.call(s,e):s.value=e,s.hasOwnProperty("constrain")&&i(),this.configs.set(t,s)):console.warn("config with name "+t+" is not defined."),this):void 0},t.prototype.accessor=function(t,e){var i;if(0===arguments.length)return this.accessors;if(1===arguments.length){if("string"==typeof t)return n(this.accessors.has(t),""+t+" is not a valid accessor."),this.accessors.get(t);for(i in t)this.accessors.set(i,t[i])}else this.accessors.set(t,e);return this},t.extend=function(t){var e=function(e){function n(i){_classCallCheck(this,n);var r;if(e.call(this,i),"function"==typeof t)t.call(this);else{for(r in t)this[r]=t[r];this.initialize.call(this)}}return _inherits(n,e),n}(this);return e},t}(),a=s;return a});
//# sourceMappingURL=koto.min.js.map