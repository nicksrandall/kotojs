var _prototypeProperties=function(t,e,n){e&&Object.defineProperties(t,e),n&&Object.defineProperties(t.prototype,n)},_classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.koto=e()}(this,function(){"use strict";function t(t,e){if(!t)throw new Error("[koto] "+e)}function e(t,e){var n,r;for(n=0,r=e.length;r>n;++n)t._chart=e[n].chart||this._base._chart,t.call(e[n].callback)}var n=function(){function e(t){_classCallCheck(this,e),this.base=t,this.hasDrawn=!1,this._layers={},this._attached={},this._events={},this._configs={},this._accessors={}}return _prototypeProperties(e,null,{transform:{value:function(t){return t},writable:!0,configurable:!0},demux:{value:function(t,e){return e},writable:!0,configurable:!0},preDraw:{value:function(){},writable:!0,configurable:!0},postDraw:{value:function(){},writable:!0,configurable:!0},unlayer:{value:function(t){var e=this.layer(t);return delete this._layers[t],delete e._chart,e},writable:!0,configurable:!0},layer:{value:function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(e,n,r){var i;if(1===arguments.length)return this._layers[e];if(2===arguments.length){if("function"==typeof n.draw)return n._chart=this,this._layers[e]=n,this._layers[e];t(!1,"When reattaching a layer, the second argument must be a d3.chart layer")}return i=n.layer(r),this._layers[e]=i,n._chart=this,i}),writable:!0,configurable:!0},attach:{value:function(t,e){return 1===arguments.length?this._attached[t]:(this._attached[t]=e,e)},writable:!0,configurable:!0},draw:{value:function(t){var e,n,r,i=this.transform(t);this.preDraw(i);for(e in this._layers)this._layers[e].draw(i);for(n in this._attached)r=this.demux?this.demux(n,i):i,this._attached[n].draw(r);this.hasDrawn=!0,this.postDraw(i)},writable:!0,configurable:!0},on:{value:function(t,e,n){var r=this._events[t]||(this._events[t]=[]);return r.push({callback:e,context:n||this,_chart:this}),this},writable:!0,configurable:!0},once:{value:function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(t,e,n){var r=this,i=function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(){r.off(t,i),e.apply(this,arguments)});return this.on(t,i,n)}),writable:!0,configurable:!0},off:{value:function(t,e,n){var r,i,a,s,o,c;if(0===arguments.length){for(t in this._events)this._events[t].length=0;return this}if(1===arguments.length)return a=this._events[t],a&&(a.length=0),this;for(r=t?[t]:Object.keys(this._events),o=0;o<r.length;o++)for(i=r[o],a=this._events[i],c=a.length;c--;)s=a[c],(e&&e===s.callback||n&&n===s.context)&&a.splice(c,1);return this},writable:!0,configurable:!0},trigger:{value:function(t){var e,n,r=Array.prototype.slice.call(arguments,1),i=this._events[t];if(void 0!==i)for(e=0;e<i.length;e++)n=i[e],n.callback.apply(n.context,r);return this},writable:!0,configurable:!0},config:{value:function(e,n){var r;if(0===arguments.length)return this._configs;if(1===arguments.length){if("object"==typeof e){for(r in e)this._configs[r]=e[r];return this}return t(this._configs[e],""+e+" is not a valid option."),this._configs[e]}return 2===arguments.length?(this._configs[e]=n,this):void 0},writable:!0,configurable:!0},accessor:{value:function(e,n){var r;if(0===arguments.length)return this._accessors;if(1===arguments.length){if("string"==typeof e)return t(this._accessors[e],""+e+" is not a valid accessor."),"object"==typeof this._accessors[e]?this._accessors[e].accessor:this._accessors[e];for(r in e)this._accessors[r]?this._accessors[r]=e[r]:console.warn(""+r+" is not a valid accessor.")}else this._accessors[e]=n;return this},writable:!0,configurable:!0}}),e}(),r=/^(enter|update|merge|exit)(:transition)?$/,i=function(){function n(t){_classCallCheck(this,n),this._base=t,this._handlers={}}return _prototypeProperties(n,null,{dataBind:{value:function(){t(!1,"Layers must specify a dataBind method.")},writable:!0,configurable:!0},insert:{value:function(){t(!1,"Layers must specify an `insert` method.")},writable:!0,configurable:!0},on:{value:function(e,n,i){return i=i||{},t(r.test(e),"Unrecognized lifecycle event name specified to 'Layer#on': '"+e+"'."),e in this._handlers||(this._handlers[e]=[]),this._handlers[e].push({callback:n,chart:i.chart||null}),this},writable:!0,configurable:!0},off:{value:function(e,n){var i,a=this._handlers[e];if(t(r.test(e),"Unrecognized lifecycle event name specified to 'Layer#on': '"+e+"'."),!a)return this._base;if(1===arguments.length)return a.length=0,this._base;for(i=a.length-1;i>-1;--i)a[i].callback===n&&a.splice(i,1);return this},writable:!0,configurable:!0},draw:{value:function(n){var r,i,a,s,o,c,l,h;r=this.dataBind.call(this._base,n),t(r instanceof d3.selection,"Invalid selection defined by `Layer#dataBind` method."),t(r.enter,"Layer selection not properly bound."),i=r.enter(),i._chart=this._base._chart,a=[{name:"update",selection:r},{name:"enter",selection:i,method:this.insert},{name:"merge",selection:r},{name:"exit",selection:r,method:r.exit}];for(var u=0,f=a.length;f>u;++u)h=a[u].name,s=a[u].selection,o=a[u].method,"function"==typeof o&&(s=o.call(s)),s.empty()||(t(s&&s instanceof d3.selection,"Invalid selection defined for "+h+" lifecycle event."),c=this._handlers[h],c&&e.call(this,s,c),l=this._handlers[h+":transition"],c&&c.length&&(s=s.transition(),e.call(this,s,l)))},writable:!0,configurable:!0}}),n}();t(d3,"d3.js is required");var a=function(){function e(t,n){_classCallCheck(this,e),this._registry={},this.Layer=t,this.Chart=n}return _prototypeProperties(e,null,{chart:{value:function(e,n){var r;return 0===arguments.length?this._registry:1===arguments.length?(r=this._registry[e],t(r,"no chart registered with name "+e),r):(this._registry[e]=n(this.Chart),this._registry[e])},writable:!0,configurable:!0}}),e}(),s=new a(i,n);return d3.selection.prototype.chart=function(t){if(0===arguments.length)return this._chart;var e=s.chart(t);return new e(this)},d3.selection.enter.prototype.chart=function(){return this._chart},d3.transition.prototype.chart=d3.selection.enter.prototype.chart,d3.selection.prototype.layer=function(t){var e,n=new i(this);if(n.dataBind=t.dataBind,n.insert=t.insert,"events"in t)for(e in t.events)n.on(e,t.events[e]);return this.on=function(){return n.on.apply(n,arguments)},this.off=function(){return n.off.apply(n,arguments)},this.draw=function(){return n.draw.apply(n,arguments)},this},s});
//# sourceMappingURL=koto.min.js.map