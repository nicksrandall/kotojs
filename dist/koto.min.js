var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var n=[],r=!0,a=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(c){a=!0,i=c}finally{try{!r&&o["return"]&&o["return"]()}finally{if(a)throw i}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},_classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.koto=t()}(this,function(){"use strict";function e(e,t){if(!e)throw new Error("[koto] "+t)}var t=e,n=function(){function e(t,n){if(_classCallCheck(this,e),this._base=t,this._handlers={},this._lifecycleRe=/^(enter|update|merge|exit)(:transition)?$/,n&&(this.dataBind=n.dataBind,this.insert=n.insert,"events"in n))for(var r in n.events)this.on(r,n.events[r])}return _createClass(e,[{key:"dataBind",value:function(){t(!1,"Layers must specify a dataBind method.")}},{key:"insert",value:function(){t(!1,"Layers must specify an `insert` method.")}},{key:"on",value:function(e,n,r){return r=r||{},t(this._lifecycleRe.test(e),"Unrecognized lifecycle event name specified to 'Layer#on': '"+e+"'."),e in this._handlers||(this._handlers[e]=[]),this._handlers[e].push({callback:n,chart:r.chart||null}),this}},{key:"off",value:function(e,n){var r,a=this._handlers[e];if(t(this._lifecycleRe.test(e),"Unrecognized lifecycle event name specified to 'Layer#on': '"+e+"'."),!a)return this;if(1===arguments.length)return a.length=0,this;for(r=a.length-1;r>-1;--r)a[r].callback===n&&a.splice(r,1);return this}},{key:"draw",value:function(e){var n,r,a,i,s,o,c,l,h,u,f;n=this.dataBind.call(this._base,e),t(n instanceof d3.selection,"Invalid selection defined by `Layer#dataBind` method."),t(n.enter,"Layer selection not properly bound."),r=n.enter(),r._chart=this._base._chart,a=[{name:"update",selection:n},{name:"enter",selection:r,method:this.insert},{name:"merge",selection:n},{name:"exit",selection:n,method:n.exit}];for(var d=0,y=a.length;y>d;++d)if(c=a[d].name,i=a[d].selection,s=a[d].method,"function"==typeof s&&(i=s.call(i)),!i.empty()){if(t(i&&i instanceof d3.selection,"Invalid selection defined for "+c+" lifecycle event."),o=this._handlers[c])for(l=0,h=o.length;h>l;++l)i._chart=o[l].chart||this._base._chart,i.call(o[l].callback);if(o=this._handlers[c+":transition"],o&&o.length)for(i=i.transition(),f=o.length,u=0;f>u;++u)i._chart=o[u].chart||this._base._chart,i.call(o[u].callback)}}}]),e}(),r=n,a=function(){function e(t){function n(e,t){function n(e){return null!==e&&"object"==typeof e}function r(e){return"function"==typeof e}for(var a=0,i=t.length;i>a;++a){var s=t[a];if(n(s)||r(s))for(var o=Object.keys(s),c=0,l=o.length;l>c;c++){var h=o[c],u=s[h];e[h]=u}}return e}_classCallCheck(this,e),this.base=t,this.hasDrawn=!1,this.merge={configs:function(){var e=n({},arguments);return this.config(e),e},accessors:function(){var e=n({},arguments);return this.accessor(e),e}},this.configs=new Map,this._layers=new Map,this._attached=new Map,this._events=new Map,this._accessors=new Map}return _createClass(e,[{key:"transform",value:function(e){return e}},{key:"demux",value:function(e,t){return t}},{key:"preUpdate",value:function(){}},{key:"postUpdate",value:function(){}},{key:"preDraw",value:function(){}},{key:"postDraw",value:function(){}},{key:"unlayer",value:function(e){var t=this.layer(e);return this._layers["delete"](e),delete t._chart,t}},{key:"layer",value:function(e,n,a){var i,s=this;if(1===arguments.length)return this._layers.get(e);if(2===arguments.length){if("function"==typeof n.draw)return n._chart=this,this._layers.set(e,n),this._layers.get(e);t(!1,"When reattaching a layer, the second argument must be a d3.chart layer")}return i=new r(n,a),this._layers.set(e,i),n._chart=this,i.remove=function(){return s._layers["delete"](e),this},i}},{key:"attach",value:function(e,t){return 1===arguments.length?this._attached.get(e):(this._attached.set(e,t),t)}},{key:"draw",value:function(e){var t,n,r=this.transform(e);this.preDraw(r);var a=!0,i=!1,s=void 0;try{for(var o,c=this._layers.values()[Symbol.iterator]();!(a=(o=c.next()).done);a=!0)t=o.value,t.draw(r)}catch(l){i=!0,s=l}finally{try{!a&&c["return"]&&c["return"]()}finally{if(i)throw s}}var h=!0,u=!1,f=void 0;try{for(var d,y=this._attached.entries()[Symbol.iterator]();!(h=(d=y.next()).done);h=!0){var v=_slicedToArray(d.value,2),g=v[0],_=v[1];n=this.demux?this.demux(g,r):r,_.draw(n)}}catch(l){u=!0,f=l}finally{try{!h&&y["return"]&&y["return"]()}finally{if(u)throw f}}this.hasDrawn=!0,this.postDraw(r)}},{key:"reDraw",value:function(e){var t,n,r=this.transform(e);this.preUpdate(r);var a=!0,i=!1,s=void 0;try{for(var o,c=this._layers.values()[Symbol.iterator]();!(a=(o=c.next()).done);a=!0)t=o.value,t.draw(r)}catch(l){i=!0,s=l}finally{try{!a&&c["return"]&&c["return"]()}finally{if(i)throw s}}var h=!0,u=!1,f=void 0;try{for(var d,y=this._attached.entries()[Symbol.iterator]();!(h=(d=y.next()).done);h=!0){var v=_slicedToArray(d.value,2),g=v[0],_=v[1];n=this.demux?this.demux(g,r):r,_.draw(n)}}catch(l){u=!0,f=l}finally{try{!h&&y["return"]&&y["return"]()}finally{if(u)throw f}}this.postUpdate(r)}},{key:"on",value:function(e,t,n){var r;return r=this._events.has(e)?this._events.get(e):new Set,r.add({callback:t,context:n||this,_chart:this}),this._events.set(e,r),this}},{key:"once",value:function(e,t,n){var r=this,a=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){r.off(e,a),t.apply(this,arguments)});return this.on(e,a,n)}},{key:"off",value:function(e,t,n){return 0===arguments.length?(this._events.clear(),this):1===arguments.length?(this._events.has(e)&&this._events.get(e).clear(),this):(this._events.get(e).forEach(function(e,r,a){(t&&t===r.callback||n&&n===r.context)&&a["delete"](e)}),this)}},{key:"trigger",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];return this._events.has(e)&&this._events.get(e).forEach(function(e){var t;(t=e.callback).call.apply(t,[e.context].concat(n))}),this}},{key:"config",value:function(e,n){var r,a;if(0===arguments.length)return this.configs;if(1===arguments.length){if("object"==typeof e){for(r in e)this.configs.has(r)?(a=this.configs.get(r),a.value=e[r],this.configs.set(r,a)):console.warn("config with name "+e+" is not defined.");return this}return t(this.configs.has(e),""+e+" is not a valid option."),this.configs.get(e).value}return 2===arguments.length?(this.configs.has(e)?(a=this.configs.get(e),a.value=n,this.configs.set(e,a)):console.warn("config with name "+e+" is not defined."),this):void 0}},{key:"accessor",value:function(e,n){var r;if(0===arguments.length)return this._accessors;if(1===arguments.length){if("string"==typeof e)return t(this._accessors.has(e),""+e+" is not a valid accessor."),this._accessors.get(e);for(r in e)this._accessors.set(r,e[r])}else this._accessors.set(e,n);return this}}]),e}(),i=a;t(d3,"d3 js is required.");var s={};s.Base=i;var o=s;return o});
//# sourceMappingURL=koto.min.js.map