function _slicedToArray(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(c){i=!0,s=c}finally{try{!r&&o["return"]&&o["return"]()}finally{if(i)throw s}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _get=function(e,t,n){for(var r=!0;r;){o=l=c=void 0,r=!1;var i=e,s=t,a=n,o=Object.getOwnPropertyDescriptor(i,s);if(void 0!==o){if("value"in o)return o.value;var c=o.get;return void 0===c?void 0:c.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=s,n=a,r=!0}},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("d3")):"function"==typeof define&&define.amd?define(["d3"],t):e.Koto=t(e.d3)}(this,function(e){"use strict";function t(e,t){if(!e)throw new Error("[koto] "+t)}var n=t,r=function(){function t(e,n){if(_classCallCheck(this,t),this._base=e,this._handlers={},this._lifecycleRe=/^(enter|update|merge|exit)(:transition)?$/,n&&(this.dataBind=n.dataBind,this.insert=n.insert,"events"in n))for(var r in n.events)this.on(r,n.events[r])}return _createClass(t,[{key:"dataBind",value:function(){n(!1,"Layers must specify a dataBind method.")}},{key:"insert",value:function(){n(!1,"Layers must specify an `insert` method.")}},{key:"on",value:function(e,t,r){return r=r||{},n(this._lifecycleRe.test(e),"Unrecognized lifecycle event name specified to 'Layer#on': '"+e+"'."),e in this._handlers||(this._handlers[e]=[]),this._handlers[e].push({callback:t,chart:r.chart||null}),this}},{key:"off",value:function(e,t){var r,i=this._handlers[e];if(n(this._lifecycleRe.test(e),"Unrecognized lifecycle event name specified to 'Layer#on': '"+e+"'."),!i)return this;if(1===arguments.length)return i.length=0,this;for(r=i.length-1;r>-1;--r)i[r].callback===t&&i.splice(r,1);return this}},{key:"draw",value:function(t){function r(e,t){var n=0;0===e.size()?t():e.each(function(){++n}).each("interrupt.promise",function(){t.apply(this,arguments)}).each("end.promise",function(){--n||t.apply(this,arguments)})}function i(e){c.call(r,function(){e(!0)})}var s,a,o,c,l,h,u,f,v,y,d,g=[];s=this.dataBind.call(this._base,t),n(s instanceof e.selection,"Invalid selection defined by `Layer#dataBind` method."),n(s.enter,"Layer selection not properly bound."),a=s.enter(),a._chart=this._base._chart,o=[{name:"update",selection:s},{name:"enter",selection:a,method:this.insert},{name:"merge",selection:s},{name:"exit",selection:s,method:s.exit}];for(var p=0,m=o.length;m>p;++p)if(u=o[p].name,c=o[p].selection,l=o[p].method,"function"==typeof l&&(c=l.call(c)),!c.empty()){if(n(c&&c instanceof e.selection,"Invalid selection defined for "+u+" lifecycle event."),h=this._handlers[u])for(f=0,v=h.length;v>f;++f)c._chart=h[f].chart||this._base._chart,c.call(h[f].callback);if(h=this._handlers[u+":transition"],h&&h.length)for(c=c.transition(),d=h.length,y=0;d>y;++y)c._chart=h[y].chart||this._base._chart,c.call(h[y].callback),g.push(new Promise(i));this.promise=Promise.all(g)}}}]),t}(),i=r;n(e,"d3 js is required.");var s=function(){function e(t){function n(e,t){for(var n=function(t,n){e.set(n,t)},r=0,i=t.length;i>r;++r){var s=t[r];s.forEach(n)}return e}_classCallCheck(this,e),this.base=t,this.hasDrawn=!1,this.merge={configs:function(){var e=n(this.configs,arguments);return e}.bind(this),accessors:function(){var e=n(this.accessors,arguments);return e}.bind(this)},this.configs=new Map,this.accessors=new Map,this.promise=null,this._layers=new Map,this._attached=new Map,this._events=new Map,this.c=this.config,this.a=this.accessor}return _createClass(e,[{key:"transform",value:function(e){return e}},{key:"demux",value:function(e,t){return t}},{key:"preDraw",value:function(){}},{key:"postDraw",value:function(){}},{key:"postTransition",value:function(){}},{key:"unlayer",value:function(e){var t=this.layer(e);return this._layers["delete"](e),delete t._chart,t}},{key:"layer",value:function(e,t,r){var s,a=this;if(1===arguments.length)return this._layers.get(e);if(2===arguments.length){if(t instanceof i)return t._chart=this,this._layers.set(e,t),this._layers.get(e);n(!1,"When reattaching a layer, the second argument must be a koto layer")}return t._chart=this,s=new i(t,r),s.remove=function(){return a._layers["delete"](e),this},this._layers.set(e,s),s}},{key:"attach",value:function(e,t){return 1===arguments.length?this._attached.get(e):(this._attached.set(e,t),t)}},{key:"draw",value:function(e){var t,n,r=[],i=this.transform(e);this.preDraw(i),this.trigger("preDraw",i);var s=!0,a=!1,o=void 0;try{for(var c,l=this._layers.values()[Symbol.iterator]();!(s=(c=l.next()).done);s=!0)t=c.value,t.draw(i),r.push(t.promise)}catch(h){a=!0,o=h}finally{try{!s&&l["return"]&&l["return"]()}finally{if(a)throw o}}var u=!0,f=!1,v=void 0;try{for(var y,d=this._attached.entries()[Symbol.iterator]();!(u=(y=d.next()).done);u=!0){var g=_slicedToArray(y.value,2),p=g[0],m=g[1];n=this.demux?this.demux(p,i):i,m.draw(n),r.push(m.promise)}}catch(h){f=!0,v=h}finally{try{!u&&d["return"]&&d["return"]()}finally{if(f)throw v}}this.hasDrawn=!0,this.promise=Promise.all(r),this.postDraw(),this.trigger("postDraw",i),this.promise.then(function(){this.postTransition(i),this.trigger("postTransition",i)}.bind(this))}},{key:"on",value:function(e,t,n){var r;return r=this._events.has(e)?this._events.get(e):new Set,r.add({callback:t,context:n||this,_chart:this}),this._events.set(e,r),this}},{key:"once",value:function(e,t,n){var r=this,i=function s(){r.off(e,s),t.apply(this,arguments)};return this.on(e,i,n)}},{key:"off",value:function(e,t,n){return 0===arguments.length?(this._events.clear(),this):1===arguments.length?(this._events.has(e)&&this._events.get(e).clear(),this):(this._events.get(e).forEach(function(e,r,i){(t&&t===r.callback||n&&n===r.context)&&i["delete"](e)}),this)}},{key:"trigger",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];return this._events.has(e)&&this._events.get(e).forEach(function(e){var t;(t=e.callback).call.apply(t,[e.context].concat(n))}),this}},{key:"config",value:function(e,t){function r(){function e(e,t){var n=Math.min.call(null,e.map(function(e){return a.config(e)}));return t/n}s.constrain===!0?s.percentage=e(["width","height"],s.value):Array.isArray(s.constrain)?s.percentage=e(s.constrain,s.value):s.percentage=e([s.constrain],s.value)}var i,s,a=this;if(0===arguments.length)return this.configs;if(1===arguments.length){if("object"==typeof e){for(i in e)this.configs.has(i)?(s=this.configs.get(i),s.hasOwnProperty("setter")?s.value=s.setter.call(s,e[i]):s.value=e[i],s.hasOwnProperty("constrain")&&r(),this.configs.set(i,s)):console.warn("config with name "+e+" is not defined.");return this}return n(this.configs.has(e),""+e+" is not a valid option."),s=this.configs.get(e),s.hasOwnProperty("getter")?s.getter.call(s):s.value}return 2===arguments.length?(this.configs.has(e)?(s=this.configs.get(e),s.hasOwnProperty("setter")?s.value=s.setter.call(s,t):s.value=t,s.hasOwnProperty("constrain")&&r(),this.configs.set(e,s)):console.warn("config with name "+e+" is not defined."),this):void 0}},{key:"accessor",value:function(e,t){var r;if(0===arguments.length)return this.accessors;if(1===arguments.length){if("string"==typeof e)return n(this.accessors.has(e),""+e+" is not a valid accessor."),this.accessors.get(e);for(r in e)this.accessors.set(r,e[r])}else this.accessors.set(e,t);return this}}],[{key:"extend",value:function(e){var t=function(t){function n(t){_classCallCheck(this,n);var r;if(_get(Object.getPrototypeOf(n.prototype),"constructor",this).call(this,t),"function"==typeof e)e.call(this);else{for(r in e)this[r]=e[r];this.initialize.call(this)}}return _inherits(n,t),n}(this);return t}}]),e}(),a=s;return a});
//# sourceMappingURL=koto.min.js.map