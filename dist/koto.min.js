var _prototypeProperties=function(a,b,c){b&&Object.defineProperties(a,b),c&&Object.defineProperties(a.prototype,c)},_classCallCheck=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")};!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.koto=b()}(this,function(){"use strict";function a(a,b){if(!a)throw new Error("[koto] "+b)}function b(a,b){var c,d;for(c=0,d=b.length;d>c;++c)a._chart=b[c].chart||this._base._chart,a.call(b[c].callback)}var c=function(){function b(a){_classCallCheck(this,b),this.base=a,this.hasDrawn=!1,this._layers={},this._attached={},this._events={},this._configs={},this._accessors={}}return _prototypeProperties(b,null,{transform:{value:function(a){return a},writable:!0,configurable:!0},demux:{value:function(a,b){return b},writable:!0,configurable:!0},preDraw:{value:function(){},writable:!0,configurable:!0},postDraw:{value:function(){},writable:!0,configurable:!0},unlayer:{value:function(a){var b=this.layer(a);return delete this._layers[a],delete b._chart,b},writable:!0,configurable:!0},layer:{value:function c(b,d,e){var c;if(1===arguments.length)return this._layers[b];if(2===arguments.length){if("function"==typeof d.draw)return d._chart=this,this._layers[b]=d,this._layers[b];a(!1,"When reattaching a layer, the second argument must be a d3.chart layer")}return c=d.layer(e),this._layers[b]=c,d._chart=this,c},writable:!0,configurable:!0},attach:{value:function(a,b){return 1===arguments.length?this._attached[a]:(this._attached[a]=b,b)},writable:!0,configurable:!0},draw:{value:function(a){var b,c,d,e=this.transform(a);this.preDraw(e);for(b in this._layers)this._layers[b].draw(e);for(c in this._attached)d=this.demux?this.demux(c,e):e,this._attached[c].draw(d);this.hasDrawn=!0,this.postDraw(e)},writable:!0,configurable:!0},on:{value:function(a,b,c){var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c||this,_chart:this}),this},writable:!0,configurable:!0},once:{value:function d(a,b,c){var e=this,d=function(){e.off(a,d),b.apply(this,arguments)};return this.on(a,d,c)},writable:!0,configurable:!0},off:{value:function(a,b,c){var d,e,f,g,h,i;if(0===arguments.length){for(a in this._events)this._events[a].length=0;return this}if(1===arguments.length)return f=this._events[a],f&&(f.length=0),this;for(d=a?[a]:Object.keys(this._events),h=0;h<d.length;h++)for(e=d[h],f=this._events[e],i=f.length;i--;)g=f[i],(b&&b===g.callback||c&&c===g.context)&&f.splice(i,1);return this},writable:!0,configurable:!0},trigger:{value:function(a){var b,c,d=Array.prototype.slice.call(arguments,1),e=this._events[a];if(void 0!==e)for(b=0;b<e.length;b++)c=e[b],c.callback.apply(c.context,d);return this},writable:!0,configurable:!0},config:{value:function(b,c){var d;if(0===arguments.length)return this._configs;if(1===arguments.length){if("object"==typeof b){for(d in b)this._configs[d]=b[d];return this}return a(this._configs[b],""+b+" is not a valid option."),this._configs[b]}return 2===arguments.length?(this._configs[b]=c,this):void 0},writable:!0,configurable:!0},accessor:{value:function(b,c){var d;if(0===arguments.length)return this._accessors;if(1===arguments.length){if("string"==typeof b)return a(this._accessors[b],""+b+" is not a valid accessor."),"object"==typeof this._accessors[b]?this._accessors[b].accessor:this._accessors[b];for(d in b)this._accessors[d]?this._accessors[d]=b[d]:console.warn(""+d+" is not a valid accessor.")}else this._accessors[b]=c;return this},writable:!0,configurable:!0}}),b}(),d=/^(enter|update|merge|exit)(:transition)?$/,e=function(){function c(a){_classCallCheck(this,c),this._base=a,this._handlers={}}return _prototypeProperties(c,null,{dataBind:{value:function(){a(!1,"Layers must specify a dataBind method.")},writable:!0,configurable:!0},insert:{value:function(){a(!1,"Layers must specify an `insert` method.")},writable:!0,configurable:!0},on:{value:function(b,c,e){return e=e||{},a(d.test(b),"Unrecognized lifecycle event name specified to 'Layer#on': '"+b+"'."),b in this._handlers||(this._handlers[b]=[]),this._handlers[b].push({callback:c,chart:e.chart||null}),this},writable:!0,configurable:!0},off:{value:function(b,c){var e,f=this._handlers[b];if(a(d.test(b),"Unrecognized lifecycle event name specified to 'Layer#on': '"+b+"'."),!f)return this._base;if(1===arguments.length)return f.length=0,this._base;for(e=f.length-1;e>-1;--e)f[e].callback===c&&f.splice(e,1);return this},writable:!0,configurable:!0},draw:{value:function(c){var d,e,f,g,h,i,j,k;d=this.dataBind.call(this._base,c),a(d instanceof d3.selection,"Invalid selection defined by `Layer#dataBind` method."),a(d.enter,"Layer selection not properly bound."),e=d.enter(),e._chart=this._base._chart,f=[{name:"update",selection:d},{name:"enter",selection:e,method:this.insert},{name:"merge",selection:d},{name:"exit",selection:d,method:d.exit}];for(var l=0,m=f.length;m>l;++l)k=f[l].name,g=f[l].selection,h=f[l].method,"function"==typeof h&&(g=h.call(g)),g.empty()||(a(g&&g instanceof d3.selection,"Invalid selection defined for "+k+" lifecycle event."),i=this._handlers[k],i&&b.call(this,g,i),j=this._handlers[k+":transition"],i&&i.length&&(g=g.transition(),b.call(this,g,j)))},writable:!0,configurable:!0}}),c}();a(d3,"d3.js is required");var f=function(){function a(b,c){_classCallCheck(this,a),this._registry={},this.Layer=b,this.Chart=c}return _prototypeProperties(a,null,{chart:{value:function(a,b){var c;return 0===arguments.length?this._registry:1===arguments.length?(c=this._registry[a],c["extends"]=function(b,c){this._registry[b]=c(this._registry[a])},c):(this._registry[a]=b(this.Chart),this._registry[a])},writable:!0,configurable:!0}}),a}(),g=new f(e,c);return d3.selection.prototype.chart=function(a){if(0===arguments.length)return this._chart;var b=g.chart(a);return new b(this)},d3.selection.enter.prototype.chart=function(){return this._chart},d3.transition.prototype.chart=d3.selection.enter.prototype.chart,d3.selection.prototype.layer=function(a){var b,c=new e(this);if(c.dataBind=a.dataBind,c.insert=a.insert,"events"in a)for(b in a.events)c.on(b,a.events[b]);return this.on=function(){return c.on.apply(c,arguments)},this.off=function(){return c.off.apply(c,arguments)},this.draw=function(){return c.draw.apply(c,arguments)},this},g});
//# sourceMappingURL=koto.min.js.map