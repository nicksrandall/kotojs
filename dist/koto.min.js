var _slicedToArray=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t)){for(var r,n=[],i=t[Symbol.iterator]();!(r=i.next()).done&&(n.push(r.value),!e||n.length!==e););return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},_prototypeProperties=function(t,e,r){e&&Object.defineProperties(t,e),r&&Object.defineProperties(t.prototype,r)},_classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):t.koto=e(t.d3)}(this,function(t){"use strict";function e(t,e){if(!t)throw new Error("[koto] "+e)}var r=function(){function t(e){_classCallCheck(this,t),this.base=e,this.hasDrawn=!1,this._layers=new Map,this._attached=new Map,this._events=new Map,this._configs=new Map,this._accessors=new Map}return _prototypeProperties(t,null,{transform:{value:function(t){return t},writable:!0,configurable:!0},demux:{value:function(t,e){return e},writable:!0,configurable:!0},preDraw:{value:function(){},writable:!0,configurable:!0},postDraw:{value:function(){},writable:!0,configurable:!0},unlayer:{value:function(t){var e=this.layer(t);return this._layers["delete"](t),delete e._chart,e},writable:!0,configurable:!0},layer:{value:function(t,r,n){var i;if(1===arguments.length)return this._layers.get(t);if(2===arguments.length){if("function"==typeof r.draw)return r._chart=this,this._layers.set(t,r),this._layers.get(t);e(!1,"When reattaching a layer, the second argument must be a d3.chart layer")}return i=r.layer(n),this._layers.set(t,i),r._chart=this,i},writable:!0,configurable:!0},attach:{value:function(t,e){return 1===arguments.length?this._attached.get(t):(this._attached.set(t,e),e)},writable:!0,configurable:!0},draw:{value:function(t){var e,r,n=this.transform(t);this.preDraw(n);var i=!0,a=!1,s=void 0;try{for(var o,l=this._layers.values()[Symbol.iterator]();!(i=(o=l.next()).done);i=!0)e=o.value,e.draw(n)}catch(c){a=!0,s=c}finally{try{!i&&l["return"]&&l["return"]()}finally{if(a)throw s}}var h=!0,u=!1,f=void 0;try{for(var g,d=this._attached.entries()[Symbol.iterator]();!(h=(g=d.next()).done);h=!0){var y=_slicedToArray(g.value,2),_=y[0],v=y[1];r=this.demux?this.demux(_,n):n,v.draw(r)}}catch(c){u=!0,f=c}finally{try{!h&&d["return"]&&d["return"]()}finally{if(u)throw f}}this.hasDrawn=!0,this.postDraw(n)},writable:!0,configurable:!0},on:{value:function(t,e,r){var n;return n=this._events.has(t)?this._events.get(t):new Set,n.add({callback:e,context:r||this,_chart:this}),this._events.set(t,n),this},writable:!0,configurable:!0},once:{value:function(t,e,r){var n=this,i=function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(){n.off(t,i),e.apply(this,arguments)});return this.on(t,i,r)},writable:!0,configurable:!0},off:{value:function(t,e,r){return 0===arguments.length?(this._events.clear(),this):1===arguments.length?(this._events.has(t)&&this._events.get(t).clear(),this):(this._events.get(t).forEach(function(t,n,i){(e&&e===n.callback||r&&r===n.context)&&i["delete"](t)}),this)},writable:!0,configurable:!0},trigger:{value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];return this._events.has(t)&&this._events.get(t).forEach(function(t){var e;(e=t.callback).call.apply(e,[t.context].concat(r))}),this},writable:!0,configurable:!0},config:{value:function(t,r){var n;if(0===arguments.length)return this._configs;if(1===arguments.length){if("object"==typeof t){for(n in t)this._configs.set(n,t[n]);return this}return e(this._configs.has(t),""+t+" is not a valid option."),this._configs.get(t)}return 2===arguments.length?(this._configs.set(t,r),this):void 0},writable:!0,configurable:!0},accessor:{value:function(t,r){var n;if(0===arguments.length)return this._accessors;if(1===arguments.length){if("string"==typeof t)return e(this._accessors.has(t),""+t+" is not a valid accessor."),this._accessors.get(t);for(n in t)this._accessors.set(n,t[n])}else this._accessors.set(t,r);return this},writable:!0,configurable:!0}}),t}(),n=/^(enter|update|merge|exit)(:transition)?$/,i=function(){function r(t){_classCallCheck(this,r),this._base=t,this._handlers={}}return _prototypeProperties(r,null,{dataBind:{value:function(){e(!1,"Layers must specify a dataBind method.")},writable:!0,configurable:!0},insert:{value:function(){e(!1,"Layers must specify an `insert` method.")},writable:!0,configurable:!0},on:{value:function(t,r,i){return i=i||{},e(n.test(t),"Unrecognized lifecycle event name specified to 'Layer#on': '"+t+"'."),t in this._handlers||(this._handlers[t]=[]),this._handlers[t].push({callback:r,chart:i.chart||null}),this._base},writable:!0,configurable:!0},off:{value:function(t,r){var i,a=this._handlers[t];if(e(n.test(t),"Unrecognized lifecycle event name specified to 'Layer#on': '"+t+"'."),!a)return this._base;if(1===arguments.length)return a.length=0,this._base;for(i=a.length-1;i>-1;--i)a[i].callback===r&&a.splice(i,1);return this._base},writable:!0,configurable:!0},draw:{value:function(r){var n,i,a,s,o,l,c,h,u,f,g;n=this.dataBind.call(this._base,r),e(n instanceof t.selection,"Invalid selection defined by `Layer#dataBind` method."),e(n.enter,"Layer selection not properly bound."),i=n.enter(),i._chart=this._base._chart,a=[{name:"update",selection:n},{name:"enter",selection:i,method:this.insert},{name:"merge",selection:n},{name:"exit",selection:n,method:n.exit}];for(var d=0,y=a.length;y>d;++d)if(c=a[d].name,s=a[d].selection,o=a[d].method,"function"==typeof o&&(s=o.call(s)),!s.empty()){if(e(s&&s instanceof t.selection,"Invalid selection defined for "+c+" lifecycle event."),l=this._handlers[c])for(h=0,u=l.length;u>h;++h)s._chart=l[h].chart||this._base._chart,s.call(l[h].callback);if(l=this._handlers[c+":transition"],l&&l.length)for(s=s.transition(),g=l.length,f=0;g>f;++f)s._chart=l[f].chart||this._base._chart,s.call(l[f].callback)}},writable:!0,configurable:!0}}),r}(),a=function(){function t(e,r){_classCallCheck(this,t),this._registry={},this.Layer=e,this.Chart=r}return _prototypeProperties(t,null,{chart:{value:function(t,r){var n,i=this;return 0===arguments.length?this._registry:1===arguments.length?(e(this._registry[t],"no chart registered with name "+t),n=this._registry[t],n.extend=function(t,e){return i._registry[t]=e(n),i._registry[t]},n):(this._registry[t]=r(this.Chart),this._registry[t])},writable:!0,configurable:!0}}),t}(),s=new a(i,r);t.selection.prototype.chart=function(t){if(0===arguments.length)return this._chart;var e=s.chart(t);return new e(this)},t.selection.enter.prototype.chart=function(){return this._chart},t.transition.prototype.chart=t.selection.enter.prototype.chart,t.selection.prototype.layer=function(t){var e,r=new i(this);if(r.dataBind=t.dataBind,r.insert=t.insert,"events"in t)for(e in t.events)r.on(e,t.events[e]);return this.on=function(){return r.on.apply(r,arguments)},this.off=function(){return r.off.apply(r,arguments)},this.draw=function(){return r.draw.apply(r,arguments)},this},e(t,"d3.js is required");var o=s;return o});
//# sourceMappingURL=koto.min.js.map